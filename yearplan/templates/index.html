<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>MY BIG GOAL</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}?v={{ asset_version }}">
</head>
<body>
  <!-- Auth Screen (shown when not logged in) -->
  <div id="auth-screen" class="auth-screen" style="display: flex;">
    <div class="auth-container">
      <h2>Welcome to Year Plan</h2>
      <p>Track your annual goals with progress monitoring and smart insights</p>
      <div class="auth-buttons">
        <button id="show-login" class="btn primary">Login</button>
        <button id="show-register" class="btn secondary">Sign Up</button>
      </div>
    </div>
  </div>

  <!-- Main App (shown when logged in) -->
  <div id="main-app" class="container" style="display: none;">
    <!-- Top Header: left title, right user menu -->
    <header class="top-header">
      <div class="header-left">
  <h1 class="app-title">MY BIG GOAL</h1>
      </div>
      <div class="header-right">
        <div class="user-dropdown">
          <button id="user-dropdown-btn" class="user-dropdown-btn">
            <span id="user-name"></span>
            <span class="dropdown-arrow">â–¼</span>
          </button>
          <div id="user-dropdown-menu" class="user-dropdown-menu" style="display: none;">
          <div class="dropdown-item" id="change-password">ğŸ”‘ Change Password</div>
          <div class="dropdown-item" id="change-email">ğŸ“§ Change Email</div>
          <div class="dropdown-item" id="reminder-settings">ğŸ”” Reminder Settings</div>
          <div class="dropdown-item" id="site-config-link" style="display:none;">ğŸ› ï¸ Site Config</div>
          <div class="dropdown-item" id="toggle-completed">ğŸ™ˆ Hide Old Goals</div>
          <div class="dropdown-divider"></div>
          <div class="dropdown-item" id="send-manual-reminder">ğŸ“Š Send Test Reminder</div>
          <div class="dropdown-divider"></div>
          <div class="dropdown-item danger" id="delete-account">ğŸ—‘ï¸ Delete Account</div>
          <div class="dropdown-divider"></div>
          <div class="dropdown-item" id="logout-btn">ğŸšª Logout</div>
          </div>
        </div>
      </div>
    </header>
    
    <!-- Empty State for first-time users (no goals yet) -->
    <div id="empty-state" class="empty-state" style="display:none;">
      <div class="empty-content">
        <h2>Welcome! Let's get started</h2>
        <p>Create your first goal to start tracking your progress.</p>
        <button id="create-first-goal" class="btn primary empty-btn">Create your first GOAL</button>
      </div>
    </div>

    <!-- Card View -->
    <div class="cards" id="cards">
      <!-- Cards will be rendered client-side for dynamic updates -->
    </div>
  </div>

  <!-- Login Modal -->
  <div id="login-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <h3>Login</h3>
      <form id="login-form">
        <div class="form-group">
          <label for="login-email">Email:</label>
          <input type="email" id="login-email" required>
        </div>
        <div class="form-group">
          <label for="login-password">Password:</label>
          <input type="password" id="login-password" required>
        </div>
        <div class="form-actions">
          <button type="button" id="cancel-login">Cancel</button>
          <button type="submit">Login</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Register Modal -->
  <div id="register-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <h3>Sign Up</h3>
      <form id="register-form">
        <div class="form-group">
          <label for="register-name">Full Name:</label>
          <input type="text" id="register-name" required>
        </div>
        <div class="form-group">
          <label for="register-email">Email:</label>
          <input type="email" id="register-email" required>
        </div>
        <div class="form-group">
          <label for="register-password">Password:</label>
          <input type="password" id="register-password" required minlength="6">
        </div>
        <div class="form-group">
          <label for="register-confirm">Confirm Password:</label>
          <input type="password" id="register-confirm" required>
        </div>
        <div class="form-actions">
          <button type="button" id="cancel-register">Cancel</button>
          <button type="submit">Sign Up</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Logs Modal -->
  <div id="logs-modal" class="modal" style="display: none;">
    <div class="modal-content logs-content">
      <div class="modal-header">
        <h3 id="logs-title">Logs for Goal</h3>
        <button id="close-logs" class="close-btn">âœ•</button>
      </div>
      <div id="logs-table-container">
                                    <table id="logs-table">
                                <thead>
                                    <tr>
                                        <th>Date & Time</th>
                                        <th>Value</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
          <tbody id="logs-tbody">
          </tbody>
        </table>
        <div id="no-logs" style="display: none;">
          <p>No logs yet for this goal.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom-right small icon buttons (footer) -->
  <div class="bottom-bar" style="display: none;">
    <a id="donate-btn" class="bottom-btn donate-btn" href="{{ donation_url }}" target="_blank" rel="noopener" title="Support this app">$</a>
    <button id="view-logs-btn" class="bottom-btn summary-btn" title="Goals Statistics" aria-label="Goals Statistics">ğŸ“Š</button>
    <button id="add-goal" class="bottom-btn add-btn square-btn" title="Add New Task">+</button>
  </div>

  <!-- Modal for adding goals -->
  <div id="goal-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <h3>Add New Goal</h3>
      <form id="goal-form">
        <div class="form-group">
          <label for="goal-text">Goal:</label>
          <input type="text" id="goal-text" placeholder="e.g., Exercise daily" required>
        </div>
        <div class="form-group">
          <label for="goal-type">Task Type:</label>
          <select id="goal-type">
            <option value="increment">Increment (Count Up) - e.g., Exercise times</option>
            <option value="decrement">Decrement (Count Down) - e.g., Weight loss</option>
            <option value="percentage">Percentage (0-100%) - e.g., Project completion</option>
          </select>
        </div>
        <div class="form-group" id="start-field">
          <label for="goal-start-value">Start:</label>
          <input type="number" id="goal-start-value" placeholder="">
          <div class="form-help">Enter your starting value (leave blank if not applicable).</div>
        </div>
        <div class="form-group" id="target-field">
          <label for="goal-target">Target:</label>
          <input type="number" id="goal-target" placeholder="e.g., 100" required>
        </div>
        <div class="form-group">
          <label for="goal-start">Start Date:</label>
          <input type="date" id="goal-start" required>
        </div>
        <div class="form-group">
          <label for="goal-end">End Date:</label>
          <div class="end-date-options">
            <div class="quick-date-buttons">
              <button type="button" class="quick-date-btn" data-days="10">10 Days</button>
              <button type="button" class="quick-date-btn" data-days="30">30 Days</button>
              <button type="button" class="quick-date-btn" data-days="100">100 Days</button>
              <button type="button" class="quick-date-btn" data-days="365">1 Year</button>
            </div>
            <div class="custom-date-section">
              <label for="goal-end" class="custom-label">Or choose custom date:</label>
              <input type="date" id="goal-end" required>
            </div>
          </div>
        </div>
        <div class="form-actions">
          <button type="button" id="cancel-goal">Cancel</button>
          <button type="submit">Add Goal</button>
        </div>
      </form>
    </div>
  </div>

  <!-- All Logs Modal (moved outside of button and grouped with modals) -->
  <div id="all-logs-modal" class="modal" style="display: none;">
    <div class="modal-content logs-content">
      <div class="modal-header">
        <h3>ğŸ“œ All Logs</h3>
        <button id="close-all-logs" class="close-btn">âœ•</button>
      </div>
      <div id="all-logs-table-container">
        <table id="all-logs-table">
          <thead>
            <tr>
              <th>Time</th>
              <th>Goal</th>
              <th>Value</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Completed Goals Section -->
  <div id="completed-goals" class="container completed-section" style="margin-top:20px;">
    <h3>âœ… Completed Goals</h3>
    <table id="completed-table" class="summary-table big">
      <thead>
        <tr>
          <th>Name</th>
          <th>Start Time</th>
          <th>End Time</th>
          <th>Start</th>
          <th>End</th>
          <th>Delta</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Missed Goals Section -->
  <div id="missed-goals" class="container miss-section" style="margin-top:16px;">
    <h3>âŒ Missed Goals</h3>
    <table id="missed-table" class="summary-table big">
      <thead>
        <tr>
          <th>Name</th>
          <th>Start Time</th>
          <th>End Time</th>
          <th>Start</th>
          <th>Current</th>
          <th>Target</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

    <!-- Goals Summary Table Modal -->
    <div id="goals-table-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
          <h3>Goals Summary <span id="goals-summary-count" style="font-weight:600;color:#6c757d"></span></h3>
          <button id="close-goals-table" class="close-btn" aria-label="Close">âœ•</button>
        </div>
        <div class="summary-legend">
          <span class="legend-item"><span class="dot dot-green"></span> âœ… On Track / ğŸš€ Ahead</span>
          <span class="legend-item"><span class="dot dot-orange"></span> âš ï¸ Behind</span>
          <span class="legend-item"><span class="dot dot-red"></span> Pending</span>
        </div>
        <div class="summary-table-container">
          <table id="goals-summary-table" class="summary-table">
            <thead>
              <tr>
                <th>Task Name</th>
                <th>Target</th>
                <th>Current</th>
                <th>Progress</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="goals-table-body"></tbody>
          </table>
        </div>
      </div>
    </div>

  <!-- Change Password Modal -->
  <div id="change-password-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <h3>Change Password</h3>
      <form id="change-password-form">
        <div class="form-group">
          <label for="current-password">Current Password:</label>
          <input type="password" id="current-password" required>
        </div>
        <div class="form-group">
          <label for="new-password">New Password:</label>
          <input type="password" id="new-password" required minlength="6">
        </div>
        <div class="form-group">
          <label for="confirm-password">Confirm New Password:</label>
          <input type="password" id="confirm-password" required minlength="6">
        </div>
        <div class="form-actions">
          <button type="button" id="cancel-password-change">Cancel</button>
          <button type="submit">Change Password</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Change Email Modal -->
  <div id="change-email-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <h3>Change Email</h3>
      <form id="change-email-form">
        <div class="form-group">
          <label for="current-email">Current Email:</label>
          <input type="email" id="current-email" readonly>
        </div>
        <div class="form-group">
          <label for="new-email">New Email:</label>
          <input type="email" id="new-email" required>
        </div>
        <div class="form-group">
          <label for="email-password">Password (for verification):</label>
          <input type="password" id="email-password" required>
        </div>
        <div class="form-actions">
          <button type="button" id="cancel-email-change">Cancel</button>
          <button type="submit">Change Email</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Delete Account Modal -->
  <div id="delete-account-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <h3>âš ï¸ Delete Account</h3>
      <p><strong>Warning:</strong> This action cannot be undone. All your goals and progress will be permanently deleted.</p>
      <form id="delete-account-form">
        <div class="form-group">
          <label for="delete-password">Enter your password to confirm:</label>
          <input type="password" id="delete-password" required>
        </div>
        <div class="form-group">
          <label>
            <input type="checkbox" id="delete-confirm" required>
            I understand that this action is permanent and cannot be undone
          </label>
        </div>
        <div class="form-actions">
          <button type="button" id="cancel-delete-account">Cancel</button>
          <button type="submit" class="btn danger">Delete My Account</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Reminder Settings Modal -->
  <div id="reminder-settings-modal" class="modal" style="display: none;">
    <div class="modal-content">
      <h3>ğŸ”” Email Reminder Settings</h3>
      <p>Stay on track with your annual goals by receiving progress reminders via email.</p>
      
      <form id="reminder-settings-form">
        <div class="form-group">
          <label for="reminder-frequency">Reminder Frequency:</label>
          <select id="reminder-frequency" name="frequency" required>
            <option value="daily">ğŸ“… Daily - Every day</option>
            <option value="weekly">ğŸ“† Weekly - Every week (Recommended)</option>
            <option value="biweekly">ğŸ—“ï¸ Bi-weekly - Every 2 weeks</option>
            <option value="monthly">ğŸ“‹ Monthly - Once a month</option>
            <option value="disabled">ğŸ”• Disabled - No reminders</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>
            <input type="checkbox" id="reminder-enabled">
            Enable email reminders
          </label>
          <div class="form-help">Uncheck to temporarily pause all reminders</div>
        </div>
        
        <div class="reminder-preview" id="reminder-preview">
          <h4>ğŸ“§ What you'll receive:</h4>
          <ul>
            <li>ğŸ“Š Your goal progress summary</li>
            <li>âœ… Completed goals celebration</li>
            <li>ğŸ”„ Goals that need attention</li>
            <li>ğŸ’¡ Motivational tips and insights</li>
            <li>ğŸ”— Quick link to update progress</li>
          </ul>
        </div>
        
        <div class="form-actions">
          <button type="button" id="cancel-reminder-settings">Cancel</button>
          <button type="submit" class="btn primary">ğŸ’¾ Save Settings</button>
        </div>
      </form>
    </div>
  </div>



  <script src="{{ url_for('static', filename='app.js') }}?v={{ asset_version }}"></script>
</body>
</html>
